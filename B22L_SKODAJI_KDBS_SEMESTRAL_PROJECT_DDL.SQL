/* ---------------------------------------------------- */
/*  Generated by Enterprise Architect Version 13.0 		*/
/*  Created On : 18-cvn-2023 12:21:04 				    */
/*  DBMS       : SQL Server 2012 						*/
/* ---------------------------------------------------- */

/* Drop Foreign Key Constraints */

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[FK_Administrativni_pracovnik_Je_zamestnan_na]') AND OBJECTPROPERTY(id, N'IsForeignKey') = 1) 
ALTER TABLE [Administrativni_pracovnik] DROP CONSTRAINT [FK_Administrativni_pracovnik_Je_zamestnan_na]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[FK_Administrativni_pracovnik_Ma_osobni_udaje]') AND OBJECTPROPERTY(id, N'IsForeignKey') = 1) 
ALTER TABLE [Administrativni_pracovnik] DROP CONSTRAINT [FK_Administrativni_pracovnik_Ma_osobni_udaje]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[FK_Firma_Ma_kontaktni_osobu]') AND OBJECTPROPERTY(id, N'IsForeignKey') = 1) 
ALTER TABLE [Firma] DROP CONSTRAINT [FK_Firma_Ma_kontaktni_osobu]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[FK_Kontrakt_Je_uzavren_s]') AND OBJECTPROPERTY(id, N'IsForeignKey') = 1) 
ALTER TABLE [Kontrakt] DROP CONSTRAINT [FK_Kontrakt_Je_uzavren_s]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[FK_Majitel_vozidla_Ma_osobni_udaje]') AND OBJECTPROPERTY(id, N'IsForeignKey') = 1) 
ALTER TABLE [Majitel_vozidla] DROP CONSTRAINT [FK_Majitel_vozidla_Ma_osobni_udaje]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[FK_Manazer_Ma_osobni_udaje]') AND OBJECTPROPERTY(id, N'IsForeignKey') = 1) 
ALTER TABLE [Manazer] DROP CONSTRAINT [FK_Manazer_Ma_osobni_udaje]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[FK_Objednavka_Byla_realizovana]') AND OBJECTPROPERTY(id, N'IsForeignKey') = 1) 
ALTER TABLE [Objednavka] DROP CONSTRAINT [FK_Objednavka_Byla_realizovana]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[FK_Objednavka_Je_obslouzena]') AND OBJECTPROPERTY(id, N'IsForeignKey') = 1) 
ALTER TABLE [Objednavka] DROP CONSTRAINT [FK_Objednavka_Je_obslouzena]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[FK_Objednavka_Je cilem]') AND OBJECTPROPERTY(id, N'IsForeignKey') = 1) 
ALTER TABLE [Objednavka] DROP CONSTRAINT [FK_Objednavka_Je cilem]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[FK_Objednavka_Je soucasti]') AND OBJECTPROPERTY(id, N'IsForeignKey') = 1) 
ALTER TABLE [Objednavka] DROP CONSTRAINT [FK_Objednavka_Je soucasti]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[FK_Objednavka_Je vyrizena]') AND OBJECTPROPERTY(id, N'IsForeignKey') = 1) 
ALTER TABLE [Objednavka] DROP CONSTRAINT [FK_Objednavka_Je vyrizena]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[FK_Objednavka_Je_objednana]') AND OBJECTPROPERTY(id, N'IsForeignKey') = 1) 
ALTER TABLE [Objednavka] DROP CONSTRAINT [FK_Objednavka_Je_objednana]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[FK_Osoba_Bydli]') AND OBJECTPROPERTY(id, N'IsForeignKey') = 1) 
ALTER TABLE [Osoba] DROP CONSTRAINT [FK_Osoba_Bydli]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[FK_Pobocka_Je_vedena]') AND OBJECTPROPERTY(id, N'IsForeignKey') = 1) 
ALTER TABLE [Pobocka] DROP CONSTRAINT [FK_Pobocka_Je_vedena]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[FK_Pobocka_Se_nachazi]') AND OBJECTPROPERTY(id, N'IsForeignKey') = 1) 
ALTER TABLE [Pobocka] DROP CONSTRAINT [FK_Pobocka_Se_nachazi]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[FK_Privatni_zakaznik_Ma_osobni_udaje]') AND OBJECTPROPERTY(id, N'IsForeignKey') = 1) 
ALTER TABLE [Privatni_zakaznik] DROP CONSTRAINT [FK_Privatni_zakaznik_Ma_osobni_udaje]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[FK_Ridic_Je_zamestnan_na]') AND OBJECTPROPERTY(id, N'IsForeignKey') = 1) 
ALTER TABLE [Ridic] DROP CONSTRAINT [FK_Ridic_Je_zamestnan_na]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[FK_Ridic_Ma_osobni_udaje]') AND OBJECTPROPERTY(id, N'IsForeignKey') = 1) 
ALTER TABLE [Ridic] DROP CONSTRAINT [FK_Ridic_Ma_osobni_udaje]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[FK_Rizeni_vozidel_Vozidlo]') AND OBJECTPROPERTY(id, N'IsForeignKey') = 1) 
ALTER TABLE [Rizeni_vozidel] DROP CONSTRAINT [FK_Rizeni_vozidel_Vozidlo]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[FK_Rizeni_vozidel_Ridic]') AND OBJECTPROPERTY(id, N'IsForeignKey') = 1) 
ALTER TABLE [Rizeni_vozidel] DROP CONSTRAINT [FK_Rizeni_vozidel_Ridic]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[FK_Vozidlo_Je_vlastneno]') AND OBJECTPROPERTY(id, N'IsForeignKey') = 1) 
ALTER TABLE [Vozidlo] DROP CONSTRAINT [FK_Vozidlo_Je_vlastneno]
GO

/* Drop Tables */

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[Administrativni_pracovnik]') AND OBJECTPROPERTY(id, N'IsUserTable') = 1) 
DROP TABLE [Administrativni_pracovnik]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[Adresa]') AND OBJECTPROPERTY(id, N'IsUserTable') = 1) 
DROP TABLE [Adresa]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[Firma]') AND OBJECTPROPERTY(id, N'IsUserTable') = 1) 
DROP TABLE [Firma]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[Jizda]') AND OBJECTPROPERTY(id, N'IsUserTable') = 1) 
DROP TABLE [Jizda]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[Kontrakt]') AND OBJECTPROPERTY(id, N'IsUserTable') = 1) 
DROP TABLE [Kontrakt]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[Majitel_vozidla]') AND OBJECTPROPERTY(id, N'IsUserTable') = 1) 
DROP TABLE [Majitel_vozidla]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[Manazer]') AND OBJECTPROPERTY(id, N'IsUserTable') = 1) 
DROP TABLE [Manazer]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[Objednavka]') AND OBJECTPROPERTY(id, N'IsUserTable') = 1) 
DROP TABLE [Objednavka]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[Osoba]') AND OBJECTPROPERTY(id, N'IsUserTable') = 1) 
DROP TABLE [Osoba]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[Pobocka]') AND OBJECTPROPERTY(id, N'IsUserTable') = 1) 
DROP TABLE [Pobocka]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[Privatni_zakaznik]') AND OBJECTPROPERTY(id, N'IsUserTable') = 1) 
DROP TABLE [Privatni_zakaznik]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[Ridic]') AND OBJECTPROPERTY(id, N'IsUserTable') = 1) 
DROP TABLE [Ridic]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[Rizeni_vozidel]') AND OBJECTPROPERTY(id, N'IsUserTable') = 1) 
DROP TABLE [Rizeni_vozidel]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[Vozidlo]') AND OBJECTPROPERTY(id, N'IsUserTable') = 1) 
DROP TABLE [Vozidlo]
GO

/* Create Tables */

CREATE TABLE [Administrativni_pracovnik]
(
	[Specializace] varchar(64) NULL,
	[Administrativni_pracovnikID] int NOT NULL IDENTITY (1, 1),
	[PobockaID] int NOT NULL,
	[OsobaID] int NOT NULL
)
GO

CREATE TABLE [Adresa]
(
	[Cislo_popisne] int NOT NULL,
	[Obec] varchar(64) NOT NULL,
	[Psc] char(5) NOT NULL,
	[Ulice] varchar(64) NOT NULL,
	[AdresaID] int NOT NULL
)
GO

CREATE TABLE [Firma]
(
	[Ico] varchar(16) NOT NULL,
	[Nazev] varchar(64) NOT NULL,
	[FirmaID] int NOT NULL IDENTITY (1, 1),
	[OsobaID] int NOT NULL
)
GO

CREATE TABLE [Jizda]
(
	[Cena_jizdy] money NOT NULL,
	[Duvod_neuskutecneni] varchar(128) NULL,
	[Vzdalenost] float NOT NULL,
	[JizdaID] int NOT NULL IDENTITY (1, 1)
)
GO

CREATE TABLE [Kontrakt]
(
	[Cena_za_km] money NOT NULL,
	[Pocet_jizd] int NOT NULL,
	[KontraktID] int NOT NULL IDENTITY (1, 1),
	[FirmaID] int NOT NULL
)
GO

CREATE TABLE [Majitel_vozidla]
(
	[Spolehlivy] bit NOT NULL,
	[Majitel_vozidlaID] int NOT NULL IDENTITY (1, 1),
	[OsobaID] int NOT NULL
)
GO

CREATE TABLE [Manazer]
(
	[Osobni_cislo] int NOT NULL,
	[ManazerID] int NOT NULL IDENTITY (1, 1),
	[OsobaID] int NOT NULL
)
GO

CREATE TABLE [Objednavka]
(
	[Cas] datetime NOT NULL,
	[Telefon] varchar(14) NOT NULL,
	[ObjednavkaID] int NOT NULL IDENTITY (1, 1),
	[AdresaID] int NOT NULL,
	[Privatni_zakaznikID] int NOT NULL,
	[KontraktID] int NULL,
	[RidicID] int NOT NULL,
	[Objednal] int NOT NULL,
	[JizdaID] int NOT NULL,
	[VozidloID] int NULL
)
GO

CREATE TABLE [Osoba]
(
	[Email] varchar(256) NOT NULL,
	[Jmeno] varchar(64) NOT NULL,
	[Prijmeni] varchar(64) NOT NULL,
	[Telefon] varchar(16) NOT NULL,
	[OsobaID] int NOT NULL IDENTITY (1, 1),
	[Je obyvana] int NOT NULL
)
GO

CREATE TABLE [Pobocka]
(
	[Nazev] varchar(64) NOT NULL,
	[PobockaID] int NOT NULL IDENTITY (1, 1),
	[AdresaID] int NOT NULL,
	[ManazerID] int NOT NULL
)
GO

CREATE TABLE [Privatni_zakaznik]
(
	[Smi_byt_prepraven] bit NULL,
	[Privatni_zakaznikID] int NOT NULL IDENTITY (1, 1),
	[OsobaID] int NOT NULL
)
GO

CREATE TABLE [Ridic]
(
	[Fotografie] varchar(256) NOT NULL,
	[RidicID] int NOT NULL IDENTITY (1, 1),
	[OsobaID] int NOT NULL,
	[PobockaID] int NOT NULL
)
GO

CREATE TABLE [Rizeni_vozidel]
(
	[VozidloID] int NOT NULL,
	[RidicID] int NOT NULL,
	[Rizeni_vozidelID] int NOT NULL IDENTITY (1, 1)
)
GO

CREATE TABLE [Vozidlo]
(
	[Barva] varchar(32) NOT NULL,
	[Model] varchar(32) NOT NULL,
	[Pocet_sedadel] int NOT NULL,
	[Rz] varchar(8) NOT NULL,
	[Tovarzni_znacka] varchar(32) NOT NULL,
	[VozidloID] int NOT NULL IDENTITY (1, 1),
	[Vlastni] int NOT NULL
)
GO

/* Create Sequences */

CREATE SEQUENCE [SeqAdresaID]
    AS INT
    START WITH 1
    INCREMENT BY 1;
GO

/* Create Primary Keys, Indexes, Uniques, Checks */

ALTER TABLE [Administrativni_pracovnik] 
 ADD CONSTRAINT [PK_Administrativni_pracovnik]
	PRIMARY KEY CLUSTERED ([Administrativni_pracovnikID] ASC)
GO

ALTER TABLE [Adresa] 
 ADD CONSTRAINT [PK_Adresa]
	PRIMARY KEY CLUSTERED ([AdresaID] ASC)
GO

ALTER TABLE [Adresa]
  ADD CONSTRAINT [PK_Adresa_Seq]
      DEFAULT NEXT VALUE FOR SeqAdresaID FOR [AdresaID]
GO

ALTER TABLE [Firma] 
 ADD CONSTRAINT [PK_Firma]
	PRIMARY KEY CLUSTERED ([FirmaID] ASC)
GO

ALTER TABLE [Jizda] 
 ADD CONSTRAINT [PK_Jizda]
	PRIMARY KEY CLUSTERED ([JizdaID] ASC)
GO

ALTER TABLE [Kontrakt] 
 ADD CONSTRAINT [PK_Kontrakt]
	PRIMARY KEY CLUSTERED ([KontraktID] ASC)
GO

ALTER TABLE [Majitel_vozidla] 
 ADD CONSTRAINT [PK_Majitel_vozidla]
	PRIMARY KEY CLUSTERED ([Majitel_vozidlaID] ASC)
GO

ALTER TABLE [Manazer] 
 ADD CONSTRAINT [PK_Manazer]
	PRIMARY KEY CLUSTERED ([ManazerID] ASC)
GO

ALTER TABLE [Objednavka] 
 ADD CONSTRAINT [PK_Objednavka]
	PRIMARY KEY CLUSTERED ([ObjednavkaID] ASC)
GO

ALTER TABLE [Osoba] 
 ADD CONSTRAINT [PK_Osoba]
	PRIMARY KEY CLUSTERED ([OsobaID] ASC)
GO

ALTER TABLE [Pobocka] 
 ADD CONSTRAINT [PK_Pobocka]
	PRIMARY KEY CLUSTERED ([PobockaID] ASC)
GO

ALTER TABLE [Privatni_zakaznik] 
 ADD CONSTRAINT [PK_Privatni_zakaznik]
	PRIMARY KEY CLUSTERED ([Privatni_zakaznikID] ASC)
GO

ALTER TABLE [Ridic] 
 ADD CONSTRAINT [PK_Ridic]
	PRIMARY KEY CLUSTERED ([RidicID] ASC)
GO

ALTER TABLE [Rizeni_vozidel] 
 ADD CONSTRAINT [PK_Rizeni_vozidel]
	PRIMARY KEY CLUSTERED ([Rizeni_vozidelID] ASC)
GO

ALTER TABLE [Vozidlo] 
 ADD CONSTRAINT [PK_Vozidlo]
	PRIMARY KEY CLUSTERED ([VozidloID] ASC)
GO

/* Create Foreign Key Constraints */

ALTER TABLE [Administrativni_pracovnik] ADD CONSTRAINT [FK_Administrativni_pracovnik_Je_zamestnan_na]
	FOREIGN KEY ([PobockaID]) REFERENCES [Pobocka] ([PobockaID]) ON DELETE No Action ON UPDATE No Action
GO

ALTER TABLE [Administrativni_pracovnik] ADD CONSTRAINT [FK_Administrativni_pracovnik_Ma_osobni_udaje]
	FOREIGN KEY ([OsobaID]) REFERENCES [Osoba] ([OsobaID]) ON DELETE No Action ON UPDATE No Action
GO

ALTER TABLE [Firma] ADD CONSTRAINT [FK_Firma_Ma_kontaktni_osobu]
	FOREIGN KEY ([OsobaID]) REFERENCES [Osoba] ([OsobaID]) ON DELETE No Action ON UPDATE No Action
GO

ALTER TABLE [Kontrakt] ADD CONSTRAINT [FK_Kontrakt_Je_uzavren_s]
	FOREIGN KEY ([FirmaID]) REFERENCES [Firma] ([FirmaID]) ON DELETE No Action ON UPDATE No Action
GO

ALTER TABLE [Majitel_vozidla] ADD CONSTRAINT [FK_Majitel_vozidla_Ma_osobni_udaje]
	FOREIGN KEY ([OsobaID]) REFERENCES [Osoba] ([OsobaID]) ON DELETE No Action ON UPDATE No Action
GO

ALTER TABLE [Manazer] ADD CONSTRAINT [FK_Manazer_Ma_osobni_udaje]
	FOREIGN KEY ([OsobaID]) REFERENCES [Osoba] ([OsobaID]) ON DELETE No Action ON UPDATE No Action
GO

ALTER TABLE [Objednavka] ADD CONSTRAINT [FK_Objednavka_Byla_realizovana]
	FOREIGN KEY ([JizdaID]) REFERENCES [Jizda] ([JizdaID]) ON DELETE No Action ON UPDATE No Action
GO

ALTER TABLE [Objednavka] ADD CONSTRAINT [FK_Objednavka_Je_obslouzena]
	FOREIGN KEY ([VozidloID]) REFERENCES [Vozidlo] ([VozidloID]) ON DELETE No Action ON UPDATE No Action
GO

ALTER TABLE [Objednavka] ADD CONSTRAINT [FK_Objednavka_Je cilem]
	FOREIGN KEY ([AdresaID]) REFERENCES [Adresa] ([AdresaID]) ON DELETE No Action ON UPDATE No Action
GO

ALTER TABLE [Objednavka] ADD CONSTRAINT [FK_Objednavka_Je soucasti]
	FOREIGN KEY ([KontraktID]) REFERENCES [Kontrakt] ([KontraktID]) ON DELETE No Action ON UPDATE No Action
GO

ALTER TABLE [Objednavka] ADD CONSTRAINT [FK_Objednavka_Je vyrizena]
	FOREIGN KEY ([RidicID]) REFERENCES [Ridic] ([RidicID]) ON DELETE No Action ON UPDATE No Action
GO

ALTER TABLE [Objednavka] ADD CONSTRAINT [FK_Objednavka_Je_objednana]
	FOREIGN KEY ([Objednal]) REFERENCES [Privatni_zakaznik] ([Privatni_zakaznikID]) ON DELETE No Action ON UPDATE No Action
GO

ALTER TABLE [Osoba] ADD CONSTRAINT [FK_Osoba_Bydli]
	FOREIGN KEY ([Je obyvana]) REFERENCES [Adresa] ([AdresaID]) ON DELETE No Action ON UPDATE No Action
GO

ALTER TABLE [Pobocka] ADD CONSTRAINT [FK_Pobocka_Je_vedena]
	FOREIGN KEY ([ManazerID]) REFERENCES [Manazer] ([ManazerID]) ON DELETE No Action ON UPDATE No Action
GO

ALTER TABLE [Pobocka] ADD CONSTRAINT [FK_Pobocka_Se_nachazi]
	FOREIGN KEY ([AdresaID]) REFERENCES [Adresa] ([AdresaID]) ON DELETE No Action ON UPDATE No Action
GO

ALTER TABLE [Privatni_zakaznik] ADD CONSTRAINT [FK_Privatni_zakaznik_Ma_osobni_udaje]
	FOREIGN KEY ([OsobaID]) REFERENCES [Osoba] ([OsobaID]) ON DELETE No Action ON UPDATE No Action
GO

ALTER TABLE [Ridic] ADD CONSTRAINT [FK_Ridic_Je_zamestnan_na]
	FOREIGN KEY ([PobockaID]) REFERENCES [Pobocka] ([PobockaID]) ON DELETE No Action ON UPDATE No Action
GO

ALTER TABLE [Ridic] ADD CONSTRAINT [FK_Ridic_Ma_osobni_udaje]
	FOREIGN KEY ([OsobaID]) REFERENCES [Osoba] ([OsobaID]) ON DELETE No Action ON UPDATE No Action
GO

ALTER TABLE [Rizeni_vozidel] ADD CONSTRAINT [FK_Rizeni_vozidel_Vozidlo]
	FOREIGN KEY ([VozidloID]) REFERENCES [Vozidlo] ([VozidloID]) ON DELETE No Action ON UPDATE No Action
GO

ALTER TABLE [Rizeni_vozidel] ADD CONSTRAINT [FK_Rizeni_vozidel_Ridic]
	FOREIGN KEY ([RidicID]) REFERENCES [Ridic] ([RidicID]) ON DELETE No Action ON UPDATE No Action
GO

ALTER TABLE [Vozidlo] ADD CONSTRAINT [FK_Vozidlo_Je_vlastneno]
	FOREIGN KEY ([Vlastni]) REFERENCES [Majitel_vozidla] ([Majitel_vozidlaID]) ON DELETE No Action ON UPDATE No Action
GO
